/*! For license information please see machina.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define("machina",["lodash"],e):"object"==typeof exports?exports.machina=e(require("lodash")):t.machina=e(t._)}(this,(t=>{return e={61:(t,e,i)=>{var n=i(4),s=i(853),a=i(354),r=a.instance,o=i(319),c="__machina__";function u(t){n.extend(this,t),n.defaults(this,s.getDefaultBehavioralOptions()),this.initialize.apply(this,arguments),r.emit(o.NEW_FSM,this)}n.extend(u.prototype,{initialize:function(){},initClient:function(t){var e=this.initialState;if(!e)throw new Error("You must specify an initial state for this FSM");if(!this.states[e])throw new Error("The initial state specified does not exist in the states object.");this.transition(t,e)},configForState:function(t){var e,i=this.states[t];return n.each(this.hierarchy,(function(t,e){t&&"function"==typeof t.off&&t.off()})),i._child&&(i._child=s.getChildFsmInstance(i._child),e=i._child&&i._child.instance,this.hierarchy[e.namespace]=s.listenToChild(this,e)),e},ensureClientMeta:function(t){if("object"!=typeof t)throw new Error("An FSM client must be an object.");return t[c]=t[c]||{},t[c][this.namespace]||(t[c][this.namespace]=n.cloneDeep(s.getDefaultClientMeta()),this.initClient(t)),t[c][this.namespace]},buildEventPayload:function(t,e){return n.isPlainObject(e)?n.extend(e,{client:t,namespace:this.namespace}):{client:t,data:e||null,namespace:this.namespace}},getHandlerArgs:function(t,e){var i=t.slice(0),n=i[1];return"object"==typeof n&&i.splice(1,1,n.inputType),e?i:[i[0]].concat(i.slice(2))},getSystemHandlerArgs:function(t,e){return[e].concat(t)},handle:function(t,e){var i=e;if(void 0===e)throw new Error("The input argument passed to the FSM's handle method is undefined. Did you forget to pass the input name?");"string"==typeof e&&(i={inputType:e,delegated:!1,ticket:void 0});var a=this.ensureClientMeta(t),r=s.getLeaklessArgs(arguments);"object"!=typeof e&&r.splice(1,1,i),a.currentActionArgs=r.slice(1);var c,u,l,h,p,f=a.state,d=this.states[f],g=!1;if(!a.inExitHandler)if(!(l=this.configForState(f))||this.pendingDelegations[i.ticket]||i.bubbling){i.ticket&&this.pendingDelegations[i.ticket]&&delete this.pendingDelegations[i.ticket],g="*"===(c=d[i.inputType]?i.inputType:"*"),u=d[c]||this[c]||this["*"],p=a.state+"."+c,a.currentAction=p;var v=this.buildEventPayload(t,{inputType:i.inputType,delegated:i.delegated,ticket:i.ticket});u?(this.emit(o.HANDLING,v),"function"==typeof u?h=u.apply(this,this.getHandlerArgs(r,g)):(h=u,this.transition(t,u)),this.emit(o.HANDLED,v)):this.emit(o.NO_HANDLER,n.extend({args:r},v)),a.priorAction=a.currentAction,a.currentAction="",a.currentActionArgs=void 0}else i.ticket=i.ticket||s.createUUID(),i.delegated=!0,this.pendingDelegations[i.ticket]={delegatedTo:l.namespace},h=l.handle.apply(l,r);return h},transition:function(t,e){var i,n=this.ensureClientMeta(t),a=n.state,r=this.states[a],c=this.states[e],u=s.getLeaklessArgs(arguments).slice(2);if(!n.inExitHandler&&e!==a){if(c){i=this.configForState(e),r&&r._onExit&&(n.inExitHandler=!0,r._onExit.call(this,t),n.inExitHandler=!1),n.targetReplayState=e,n.priorState=a,n.state=e;var l=this.buildEventPayload(t,{fromState:n.priorState,action:n.currentAction,toState:e});return this.emit(o.TRANSITION,l),c._onEnter&&c._onEnter.apply(this,this.getSystemHandlerArgs(u,t)),this.emit(o.TRANSITIONED,l),i&&i.handle(t,"_reset"),void(n.targetReplayState===e&&this.processQueue(t,o.NEXT_TRANSITION))}this.emit(o.INVALID_STATE,this.buildEventPayload(t,{state:n.state,attemptedState:e}))}},deferUntilTransition:function(t,e){var i=this.ensureClientMeta(t),s=n.isArray(e)?e:e?[e]:void 0;if(i.currentActionArgs){var a={type:o.NEXT_TRANSITION,untilState:s,args:i.currentActionArgs};i.inputQueue.push(a);var r=this.buildEventPayload(t,{state:i.state,queuedArgs:a});this.emit(o.DEFERRED,r)}},deferAndTransition:function(t,e){this.deferUntilTransition(t,e),this.transition(t,e)},processQueue:function(t){var e=this.ensureClientMeta(t),i=n.filter(e.inputQueue,(function(t){return!t.untilState||n.includes(t.untilState,e.state)}));e.inputQueue=n.difference(e.inputQueue,i),n.each(i,function(e){this.handle.apply(this,[t].concat(e.args))}.bind(this))},clearQueue:function(t,e){var i=this.ensureClientMeta(t);e?(n.each(i.inputQueue,(function(t){t.untilState=n.without(t.untilState,e)})),i.inputQueue=n.filter(i.inputQueue,(function(t){return 0!==t.untilState.length}))):i.inputQueue=[]},compositeState:function(t){var e=this.ensureClientMeta(t).state,i=this.states[e]._child&&this.states[e]._child.instance;return i&&(e+="."+i.compositeState(t)),e}},a.getInstance()),u.extend=s.extend,t.exports=u},451:(t,e,i)=>{var n=i(61),s=i(853),a=i(4),r={constructor:function(){n.apply(this,arguments),this.ensureClientMeta()},initClient(){var t=this.initialState;if(!t)throw new Error("You must specify an initial state for this FSM");if(!this.states[t])throw new Error("The initial state specified does not exist in the states object.");this.transition(t)},ensureClientMeta(){return this._stamped||(this._stamped=!0,a.defaults(this,a.cloneDeep(s.getDefaultClientMeta())),this.initClient()),this},ensureClientArg:function(t){var e=t;return"object"!=typeof e[0]||"inputType"in e[0]||e[0]===this?("object"!=typeof e[0]||"object"==typeof e[0]&&"inputType"in e[0])&&e.unshift(this):e.splice(0,1,this),e},getHandlerArgs:function(t,e){var i=t,n=i[1];return"object"==typeof inputType&&i.splice(1,1,n.inputType),e?i.slice(1):i.slice(2)},getSystemHandlerArgs:function(t,e){return t},buildEventPayload:function(){var t=this.ensureClientArg(s.getLeaklessArgs(arguments))[1];return a.isPlainObject(t)?a.extend(t,{namespace:this.namespace}):{data:t||null,namespace:this.namespace}}};a.each(["handle","transition","deferUntilTransition","processQueue","clearQueue"],(function(t){r[t]=function(){var e=this.ensureClientArg(s.getLeaklessArgs(arguments));return n.prototype[t].apply(this,e)}})),r=n.extend(r),t.exports=r},354:(t,e,i)=>{var n=i(853),s=i(4);function a(){return{emit(t){var e=n.getLeaklessArgs(arguments);this.eventListeners["*"]&&s.each(this.eventListeners["*"],function(t){if(this.useSafeEmit)try{t.apply(this,e)}catch(t){console&&void 0!==console.log&&console.log(t.stack)}else t.apply(this,e)}.bind(this)),this.eventListeners[t]&&s.each(this.eventListeners[t],function(t){if(this.useSafeEmit)try{t.apply(this,e.slice(1))}catch(t){console&&void 0!==console.log&&console.log(t.stack)}else t.apply(this,e.slice(1))}.bind(this))},on(t,e){var i=this;return i.eventListeners=i.eventListeners||{"*":[]},i.eventListeners[t]||(i.eventListeners[t]=[]),i.eventListeners[t].push(e),{eventName:t,callback:e,off:function(){i.off(t,e)}}},off(t,e){this.eventListeners=this.eventListeners||{"*":[]},t?this.eventListeners[t]=e?s.without(this.eventListeners[t],e):[]:this.eventListeners={}}}}t.exports={getInstance:a,instance:a()}},319:t=>{t.exports={NEXT_TRANSITION:"transition",HANDLING:"handling",HANDLED:"handled",NO_HANDLER:"nohandler",TRANSITION:"transition",TRANSITIONED:"transitioned",INVALID_STATE:"invalidstate",DEFERRED:"deferred",NEW_FSM:"newfsm"}},579:(t,e,i)=>{var n=i(4),s=i(354);t.exports=n.merge(s.instance,{Fsm:i(451),BehavioralFsm:i(61),utils:i(853),eventListeners:{newFsm:[]}})},853:(t,e,i)=>{var n,s=[].slice,a=i(319),r=i(4),o=(n=0,function(){return"fsm."+n++});function c(){return{initialState:"uninitialized",eventListeners:{"*":[]},states:{},namespace:o(),useSafeEmit:!1,hierarchy:{},pendingDelegations:{}}}var u=["states","initialState"];t.exports={createUUID:function(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")},extend:function(t,e){var i,n=this,a={},o=function(){};return i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){var t,e=s.call(arguments,0);e[0]=e[0]||{};var i=e[0].states||{};(t=r.merge(r.cloneDeep(a),{states:i})).initialState=e[0].initialState||this.initialState,r.extend(e[0],t),n.apply(this,e)},r.merge(i,n),o.prototype=n.prototype,i.prototype=new o,t&&(r.extend(i.prototype,t),r.merge(a,r.transform(t,(function(t,e,i){-1!==u.indexOf(i)&&(t[i]=e)})))),e&&r.merge(i,e),i.prototype.constructor=i,i.__super__=n.prototype,i},getDefaultBehavioralOptions:c,getDefaultOptions:c,getDefaultClientMeta:function(){return{inputQueue:[],targetReplayState:"",state:void 0,priorState:void 0,priorAction:"",currentAction:"",currentActionArgs:void 0,inExitHandler:!1}},getChildFsmInstance:function(t){if(t){var e={};return"object"==typeof t?t.factory?(e=t).instance=e.factory():e.factory=function(){return t}:"function"==typeof t&&(e.factory=t),e.instance=e.factory(),e}},getLeaklessArgs:function(t,e){for(var i=[],n=e||0;n<t.length;n++)i[n]=t[n];return i},listenToChild:function(t,e){return e.on("*",(function(e,i){switch(e){case a.NO_HANDLER:i.ticket||i.delegated||i.namespace===t.namespace||(i.args[1].bubbling=!0),"_reset"!==i.inputType&&t.handle.apply(t,i.args);break;case a.HANDLING:var n=i.ticket;n&&t.pendingDelegations[n]&&delete t.pendingDelegations[n],t.emit(e,i);break;default:t.emit(e,i)}}))},makeFsmNamespace:o}},4:e=>{"use strict";e.exports=t}},i={},function t(n){var s=i[n];if(void 0!==s)return s.exports;var a=i[n]={exports:{}};return e[n](a,a.exports,t),a.exports}(579);var e,i}));
//# sourceMappingURL=machina.min.js.map